#!/bin/bash

# Стандартний префікс
PREFIX="/usr/local"

# Розбір аргументів
for arg in "$@"; do
    case $arg in
        --prefix=*)
            PREFIX="${arg#*=}"
            shift
            ;;
        *)
            echo "Unknown option: $arg"
            ;;
    esac
done

# Перевірка компілятора
if command -v gcc >/dev/null 2>&1; then
    CC=gcc
elif command -v clang >/dev/null 2>&1; then
    CC=clang
else
    echo "Error: no C compiler found (gcc or clang required)"
    exit 1
fi

echo "Using compiler: $CC"
echo "Installation prefix: $PREFIX"

# Створюємо Makefile
cat > Makefile <<EOF
CC=$CC
CFLAGS=-O2
PREFIX=$PREFIX

all: hello_sora

hello_sora: hello_sora.c
	\$(CC) \$(CFLAGS) -o hello_sora hello_sora.c

install: hello_sora
	mkdir -p \$(DESTDIR)\$(PREFIX)/bin
	cp hello_sora \$(DESTDIR)\$(PREFIX)/bin/

uninstall:
	rm -f \$(DESTDIR)\$(PREFIX)/bin/hello_sora

clean:
	rm -f hello_sora

.PHONY: all install uninstall clean
EOF

echo "Configuration complete. You can now run 'make', 'make install' and 'make uninstall'."
